# True黄皮书让我来解读

一、truechain到底是什么

我们可以通过truechain的官方资料，可以看到truechain做了以下定义：

1. truechain目标是商业级高性能公链
2. truechain采用业界领先的混合共识机制
3. truechain坚持去中心化为技术架构的第一纲领

二、黄皮书解读

区块链技术经过数十年的发展，采用某一种共识机制的公链不能满足"效率+去中心化"的目标。我们可以看到前两代已落地成熟运行的公链比特币和以太坊，它们的tps过低导致根本没法进行商业级应用的开发。而truechain采用PBFT+POW混合共识机制，致力于解决效率与去中心化无法兼顾的行业痛点。

POW共识算法存在tps瓶颈问题，而PBFT共识虽然能提供高tps，但是要求链上节点一开始就是互信的，显然不能直接在公链系统中直接使用。truechain采用混合共识机制，在保留PBFT高tps的情况下，利用POW来选取超级节点，这样实现性能与去中心化的兼顾。

1. 节点选取

   BFT节点选取目前是固定时间更换一次。这在公链上就存在一个问题，当前节点为啥要被换？如果当前节点是优质节点，不应该强制把它换下来，那如果不换，又没法让新的节点加入。于是我们需要在这中间进行一种权衡，即通过特定算法，每隔一段时间更换一次节点，降低更换频率。truechain在这里借鉴了Thunderella的想法，POW用来证明BFT链是否出错，一旦情况发生，很快就会更换节点，不用等到固定的某个时间。此外，truechain采用POS+VRF混合选取节点，避免了VRF随机过程被一些掌握巨大资源的掌控。

2. 时间戳

   最终一致性与安全性是公链最重要的。传统的共识机制有一定的时间窗口，这就给恶意节点留下了作恶的通道。它们可以插入自身合约或者恶意更改合约执行顺序。这种由于天然网络造成的延迟，是很难被发现的，除非接受的人自己发现。而truechain的粘性时间戳这一限制，通过BFT验证器，将有效检验这笔交易的正确性。

3. 推断执行

   truechain设计了基于片区的推断执行系统，BFT节点索引自一个日常BFT节点序列，允许同时间的多重序列。

4. 计算与数据片区

   存在一个与社区节点数目一致的主片，负责对子片输出排序并协调分布式交易。同时对社区选举流程进行规定，任何片区不能共享同一节点。片区选取与混合共识选举类似。

5. 虚拟机

   超级账本的架构如果使用在公链上，则需要解决链码问题。而链码又涉及到容器问题。几千个智能合约需要几千个容器，显然这是不现实的。所以在架构上仍然采用EVM设计，并在EVM基础上，做一些调整与优化，使其适应truechain的性能要求。

6. 奖励机制

   BFT的社区与非社区节点的工作量奖励是奖励机制最核心的问题。

   truechain采用混合共识，公平随机抽取，并轮换社区的制度，避免某个节点拥有持续性的奖励，尽可能保证财富的公平分配。

   truechain设置了BFT与POW奖励机制，设置了BFT、POW、奖励池分配资源的优先级，BFT节点被投票出网络，但是可以继续为网络其余部分提供补偿机制享受投资硬件带来的收益。所有节点都可以完成PBFT和POW任务，但是PBFT优先级更高。

总结：我们看到truechain团队在推动区块链技术进步上的努力，混合共识在工程上实现具有很大的挑战，目前还没一个能落地稳定运行的混合共识公链。希望truechain团队能在这条路上走的越来越好。
